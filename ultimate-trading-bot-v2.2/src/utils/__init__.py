"""
Utilities Package for Ultimate Trading Bot v2.2.

This package provides common utilities used throughout the trading bot.
"""

from src.utils.exceptions import (
    TradingBotException,
    ErrorCode,
    ConfigurationError,
    InitializationError,
    ValidationError,
    DataError,
    DataFetchError,
    DataParseError,
    DataMissingError,
    DataInvalidError,
    DataStaleError,
    TradingError,
    OrderError,
    OrderCreationError,
    OrderSubmissionError,
    OrderRejectedError,
    OrderNotFoundError,
    OrderModificationError,
    OrderCancellationError,
    InsufficientFundsError,
    InsufficientSharesError,
    PositionError,
    PositionNotFoundError,
    PositionLimitError,
    RiskError,
    RiskLimitError,
    RiskViolationError,
    MarketClosedError,
    SymbolNotTradableError,
    APIError,
    APIConnectionError,
    APIAuthenticationError,
    APIAuthorizationError,
    APIRateLimitError,
    APITimeoutError,
    APIResponseError,
    APIUnavailableError,
    AIError,
    AIRequestError,
    AIResponseError,
    AIBudgetExceededError,
    AIRateLimitError,
    AIContentFilterError,
    AIInvalidModelError,
    DatabaseError,
    DatabaseConnectionError,
    DatabaseQueryError,
    DatabaseWriteError,
    DatabaseIntegrityError,
    CacheError,
    CacheConnectionError,
    CacheReadError,
    CacheWriteError,
    StrategyError,
    StrategyLoadError,
    StrategyExecutionError,
    StrategyValidationError,
    StrategyNotFoundError,
    BacktestError,
    BacktestDataError,
    BacktestExecutionError,
)

from src.utils.helpers import (
    generate_id,
    generate_uuid,
    generate_short_uuid,
    slugify,
    truncate,
    camel_to_snake,
    snake_to_camel,
    mask_string,
    round_price,
    round_quantity,
    round_decimal,
    format_currency,
    format_percent,
    format_number,
    clamp,
    normalize,
    is_close,
    chunk_list,
    flatten,
    unique,
    group_by,
    first,
    safe_get,
    deep_merge,
    ensure_directory,
    get_file_hash,
    safe_json_loads,
    safe_json_dumps,
    read_json_file,
    write_json_file,
    is_valid_symbol,
    is_valid_email,
    is_valid_url,
    hash_string,
    generate_cache_key,
    to_bool,
    to_int,
    to_float,
    to_list,
    get_env,
    get_env_bool,
    get_env_int,
    get_env_float,
)

from src.utils.date_utils import (
    ET,
    CT,
    PT,
    UTC,
    MARKET_TZ,
    MARKET_OPEN,
    MARKET_CLOSE,
    PRE_MARKET_OPEN,
    AFTER_HOURS_CLOSE,
    now_utc,
    now_et,
    now_market,
    today_utc,
    today_market,
    to_utc,
    to_et,
    to_market_tz,
    localize,
    make_aware,
    make_naive,
    is_market_holiday,
    is_early_close_day,
    is_weekend,
    is_trading_day,
    get_market_close_time,
    is_market_open,
    is_pre_market,
    is_after_hours,
    is_extended_hours,
    get_market_session,
    time_until_market_open,
    time_until_market_close,
    get_next_trading_day,
    get_previous_trading_day,
    get_trading_days,
    get_trading_day_count,
    get_n_trading_days_ago,
    get_n_trading_days_from,
    get_week_start,
    get_week_end,
    get_month_start,
    get_month_end,
    get_quarter_start,
    get_quarter_end,
    get_year_start,
    get_year_end,
    parse_date,
    parse_datetime,
    format_date,
    format_datetime,
    format_timestamp,
    to_timestamp,
    from_timestamp,
    time_ago,
    time_until,
)

from src.utils.math_utils import (
    safe_divide,
    percentage_change,
    percentage_difference,
    compound_return,
    annualized_return,
    log_return,
    simple_return,
    mean,
    weighted_mean,
    median,
    mode,
    variance,
    std_dev,
    covariance,
    correlation,
    percentile,
    z_score,
    z_scores,
    sharpe_ratio,
    sortino_ratio,
    calmar_ratio,
    information_ratio,
    max_drawdown,
    drawdown_series,
    win_rate,
    profit_factor,
    expectancy,
    beta,
    alpha,
    value_at_risk,
    expected_shortfall,
    kelly_criterion,
    position_size_risk_based,
    volatility_adjusted_size,
)

from src.utils.validators import (
    validate_symbol,
    validate_symbols,
    validate_order_side,
    validate_order_type,
    validate_time_in_force,
    validate_quantity,
    validate_price,
    validate_order,
    validate_dataframe_columns,
    validate_ohlcv_data,
    validate_date_range,
    validate_type,
    validate_enum,
    validate_range,
    validate_percentage,
    validate_model,
    validate_json_schema,
    validate_position_size,
    validate_risk_per_trade,
)

from src.utils.decorators import (
    timer,
    async_timer,
    timeout,
    async_timeout,
    retry,
    async_retry,
    cache,
    async_cache,
    memoize,
    log_call,
    log_exceptions,
    async_log_exceptions,
    rate_limit,
    async_rate_limit,
    validate_args,
    singleton,
    deprecated,
    synchronized,
    run_in_thread,
    circuit_breaker,
    LRUCache,
    RateLimiter,
    CircuitBreaker,
)

from src.utils.async_utils import (
    gather_with_concurrency,
    gather_with_exceptions,
    run_with_timeout,
    first_completed,
    all_completed,
    async_map,
    async_filter,
    async_reduce,
    chunked_async,
    AsyncQueue,
    AsyncWorkerPool,
    get_thread_pool,
    get_process_pool,
    run_in_thread as async_run_in_thread,
    run_in_process,
    sync_to_async,
    AsyncEvent,
    AsyncCondition,
    timeout_context,
    cleanup_on_error,
    sleep_until,
    periodic,
    create_task_with_logging,
    cancel_tasks,
)

from src.utils.ai_utils import (
    estimate_tokens,
    estimate_tokens_messages,
    count_tokens_tiktoken,
    truncate_to_tokens,
    extract_json,
    extract_code_blocks,
    parse_structured_response,
    parse_sentiment_score,
    parse_trading_signal,
    format_messages,
    format_context,
    create_few_shot_prompt,
    encode_image_base64,
    encode_image_bytes,
    get_image_mime_type,
    create_image_content,
    TokenUsage,
    CostEstimate,
    estimate_cost,
    generate_cache_key as ai_cache_key,
    sanitize_input,
    validate_response,
    mask_sensitive_data,
)


__all__ = [
    # Exceptions
    "TradingBotException",
    "ErrorCode",
    "ConfigurationError",
    "InitializationError",
    "ValidationError",
    "DataError",
    "DataFetchError",
    "DataParseError",
    "DataMissingError",
    "DataInvalidError",
    "DataStaleError",
    "TradingError",
    "OrderError",
    "OrderCreationError",
    "OrderSubmissionError",
    "OrderRejectedError",
    "OrderNotFoundError",
    "OrderModificationError",
    "OrderCancellationError",
    "InsufficientFundsError",
    "InsufficientSharesError",
    "PositionError",
    "PositionNotFoundError",
    "PositionLimitError",
    "RiskError",
    "RiskLimitError",
    "RiskViolationError",
    "MarketClosedError",
    "SymbolNotTradableError",
    "APIError",
    "APIConnectionError",
    "APIAuthenticationError",
    "APIAuthorizationError",
    "APIRateLimitError",
    "APITimeoutError",
    "APIResponseError",
    "APIUnavailableError",
    "AIError",
    "AIRequestError",
    "AIResponseError",
    "AIBudgetExceededError",
    "AIRateLimitError",
    "AIContentFilterError",
    "AIInvalidModelError",
    "DatabaseError",
    "DatabaseConnectionError",
    "DatabaseQueryError",
    "DatabaseWriteError",
    "DatabaseIntegrityError",
    "CacheError",
    "CacheConnectionError",
    "CacheReadError",
    "CacheWriteError",
    "StrategyError",
    "StrategyLoadError",
    "StrategyExecutionError",
    "StrategyValidationError",
    "StrategyNotFoundError",
    "BacktestError",
    "BacktestDataError",
    "BacktestExecutionError",
    # Helpers
    "generate_id",
    "generate_uuid",
    "slugify",
    "truncate",
    "round_price",
    "round_quantity",
    "format_currency",
    "format_percent",
    "chunk_list",
    "flatten",
    "unique",
    "group_by",
    "safe_get",
    "deep_merge",
    "ensure_directory",
    "read_json_file",
    "write_json_file",
    # Date utils
    "now_utc",
    "now_et",
    "now_market",
    "is_market_open",
    "is_trading_day",
    "get_next_trading_day",
    "get_previous_trading_day",
    "get_trading_days",
    "parse_date",
    "parse_datetime",
    "format_date",
    "format_datetime",
    # Math utils
    "safe_divide",
    "percentage_change",
    "mean",
    "std_dev",
    "correlation",
    "sharpe_ratio",
    "sortino_ratio",
    "max_drawdown",
    "win_rate",
    "profit_factor",
    "kelly_criterion",
    "value_at_risk",
    # Validators
    "validate_symbol",
    "validate_order",
    "validate_quantity",
    "validate_price",
    # Decorators
    "timer",
    "retry",
    "async_retry",
    "cache",
    "rate_limit",
    "singleton",
    # Async utils
    "gather_with_concurrency",
    "run_with_timeout",
    "AsyncQueue",
    "AsyncWorkerPool",
    # AI utils
    "estimate_tokens",
    "extract_json",
    "parse_sentiment_score",
    "parse_trading_signal",
    "format_messages",
    "TokenUsage",
    "CostEstimate",
    "estimate_cost",
]
